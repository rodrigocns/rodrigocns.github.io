<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>iRT - interactive Rotation Tasks</title>
  <link rel="stylesheet" href="css/screen.css" type="text/css" >
  <script src="jsmol/JSmol.min.js"></script>
  <script src="javascript/object_configs.js"></script>
  <script src="jspsych/jspsych.js"></script>
  <script src="jspsych/plugin-html-keyboard-response.js"></script>
  <script src="https://unpkg.com/@jspsych/plugin-preload@2.1.0"></script>
  <script src="https://unpkg.com/@jspsych-contrib/plugin-corsi-blocks@2.0.0"></script>
  <script src="jspsych/plugin-html-button-response.js"></script>
  <script src="javascript/scripts_jspsych.js"></script>
  <style>
    #jspsych-corsi-stimulus {
      margin: auto;
    }
  </style>
  <!--<link href="jspsych/jspsych.css" rel="stylesheet" type="text/css" /> -->
</head>

<body>
  <!-- debug mode switch -->
  <div style="text-align:right"><span id="debug_switch" style="color:#404040" onclick="debug()">Debug</span></div>
  
  <!-- <section class="w3-container w3-center w3-animate-opacity"> -->
  <section id="tab_navigation" class="debug">
    <div class="dev-div">
      You are in debug mode! If this was a mistake, please click again in the corner of the screen, or reload the page, and forget you saw this! ;D
      <br>
      <!-- webpage Links -->
      <a class="dev-div" href="rodrigocns.github.io">
      Home</a>
      <a class="dev-div" href="https://script.google.com/home/projects/1L21yINxKMX5ngrT7JYiIOuATQeicxtVxDmKmXGD_rSoaXtIG8n0nrACp/deployments/AKfycbxtKza8SDt27Ik39cktDyv66dD2Lt77vERuHWOVEnraLH91kQwBl1r2bPQoD8Gi1BZW">
      AppScript</a> 
      <a class="dev-div" href="https://docs.google.com/spreadsheets/d/1LSDoA22scyWVJUDlwudKqX0o86w5b-Ds-lGOhRBGYis/edit#gid=0">
      Gsheets</a>
      <!-- section navigation buttons -->
      <nav>
        <ul>
          <li><a href="#tab_form">Forms</a></li>
          <li><a href="#tab_teste">Test</a></li>
          <!-- <li><a href="#tab3">Graph</a></li> WIP -->
        </ul>
        <!-- start the different tasks of the interactive test -->
        <div id="button-container"></div>
        <hr>
      </nav>
    </div>
  </section>
  
  <!-- Forms -->
  <section id="tab_form" class="ContentStage current-ContentStage" style="display:block"> 
    <div id="div_form">
      <form name="submit-to-google-sheet" id="gsForm">
        <!-- Escreva nome e email para contato caso queira receber notícias sobre a pesquisa e clique em próximo. -->
        <p>
          Se desejar receber informações sobre a pesquisa 
        e sobre o seu desempenho nos testes,<br>
        escreva nome e e-mail de contato.<br> 
        Os seus dados serão armazenados anonimamente e mantidos em sigilo.
        </p>
        
        <!-- Template: 
         Text in Html: 
         <input name="column header in gsheets" type="input type"> -->
        <!-- for more input options: https://www.w3schools.com/js/js_input_examples.asp  -->
        <p> Nome (opcional): 
          <input name="fname" type="text" placeholder="Ex: Rodrigo Alves" size="30" autofocus></p>
        <p> Email (opcional): 
          <input name="email" type="text" placeholder="Ex: rodrigo@gmail.com" size="30"></p>
        <hr>
        <h2> Preencha os campos abaixo:
        </h3><br>
        <p> Já participou desta pesquisa anteriormente?<br>
          <input type="radio" name="p_repeat" id="p_repeat_sim" value="Sim">
          <label for="p_repeat_sim">Sim</label> |
          <input type="radio" name="p_repeat" id="p_repeat_nao" value="Não">
          <label for="p_repeat_nao">Não</label>
        </p>
        <p> Qual curso você está matriculado? <br>
          <input type="text" name="p_curso">
        </p>
        <p> E está cursando qual semestre? <br>
          <input type="number" name="p_semester" min="1">
        </p>
        <p> Você já foi identificado como um estudante superdotado? <br>
          <input type="radio" name="p_gifted" id="p_gifted_sim" value="Sim">
          <label for="p_gifted_sim">Sim</label> |
          <input type="radio" name="p_gifted" id="p_gifted_nao" value="Não">
          <label for="p_gifted_nao">Não</label>
        </p>
        <p> Sexo: <br>
          <input type="radio" name="p_sex" id="p_sex_male" value="male">
          <label for="p_sex_male">Masculino</label>
          <input type="radio" name="p_sex" id="p_sex_female" value="female">
          <label for="p_sex_female">Feminino</label>
        </p>
        <p> Idade: <br>
          <label for="p_birthday">Nascimento:</label>
          <input type="date" id="p_birthday" name="birthday">
        </p>
        <p> Etnia: <br>
          <input type="text" name="p_ethnic">
        </p>
        <p> Já exerceu atividade remunerada? Em qual área?<br>
          <input type="text" name="p_work">
        </p>
        <p> Com que frequência (sendo 0 nunca, e 9 constantemente) você: <br>
          <label for="p_3dmodels">Usa modelos tridimensionais? </label>
          <span id="p_3dmodels_value">0</span>
          <input type="range" id="p_3dmodels" name="p_3dmodels" min="0" max="9" >
          <br>
        </p>
        <script>
          //Update number of range input when changing slider
          const rangeInput = document.getElementById("p_3dmodels");
          const rangeValue = document.getElementById("p_3dmodels_value");
          rangeInput.addEventListener ("input", () => {
            rangeValue.innerText = rangeInput.value;
          });
        </script>

        <!-- internal values to be sent by forms -->
        <!-- Changes here should be replicated in scripts.js -->
        <input type="hidden" name="sessionID">
        <input type="hidden" name="taskID">
        <input type="hidden" name="pxAngstRatio">
        <input type="hidden" name="epochStart">
        <input type="hidden" name="epochArr">
        <input type="hidden" name="duration">
        <input type="hidden" name="fQi">
        <input type="hidden" name="fQj">
        <input type="hidden" name="fQk">
        <input type="hidden" name="fQr">
        <input type="hidden" name="ref_i">
        <input type="hidden" name="ref_j">
        <input type="hidden" name="ref_k">
        <input type="hidden" name="ref_r">
        <input type="hidden" name="scrSizeX">
        <input type="hidden" name="scrSizeY">
        <input type="hidden" name="cvsRefTop">
        <input type="hidden" name="cvsRefRight">
        <input type="hidden" name="cvsRefBottom">
        <input type="hidden" name="cvsRefLeft">
        <input type="hidden" name="cvsIntTop">
        <input type="hidden" name="cvsIntRight">
        <input type="hidden" name="cvsIntBottom">
        <input type="hidden" name="cvsIntLeft">
        <input type="hidden" name="pxRatio">
        <input type="hidden" name="browser">
        <input type="hidden" name="modelName">
        <input type="hidden" name="paperAnswer">
        <input type="hidden" name="corsiScore">
        <input type="hidden" name="corsiTrialCorrect">
        <input type="hidden" name="corsiTrialCount">
        
      </form>
    </div>
    <hr>
    Clique em 'Próximo' para continuar.

    <div style="height: 100px;">
      <button onclick="nextStage();prepMolecule(task_n);openFullscreen();
      removeById('last-updated');">Próximo</button>
    </div>
  </section>
  
  <!-- paper-to-screen task intro-->
  <section id="tab_paper_intro" class="ContentStage" style="display:none"> 
    <!--document.getElementById("imgmap").src = "images/img ("+imgmap_n+").jpg"-->
    <div style="position: relative; display: inline-block;">
      <img id="imgmap-intro1" src="images/PSVT-R Intro pt-br (1).jpg" usemap="#task_intro1_map" height="750"> 
      <map name="task_intro1_map" style="cursor: pointer">
        <area shape="rect" coords=" 119,430, 247,570" alt="A" onclick="document.getElementById('mapA').style.border='thick solid red'">
        <area shape="rect" coords=" 273,430, 401,570" alt="B" onclick="document.getElementById('mapB').style.border='thick solid red'">
        <area shape="rect" coords=" 430,430, 558,570" alt="C" onclick="document.getElementById('mapC').style.border='thick solid red'">
        <area shape="rect" coords=" 585,430, 713,570" alt="D" onclick="document.getElementById('mapD').style.border='thick solid green';unhideById('button-end-paper-intro')">
        <area shape="rect" coords=" 737,430, 865,570" alt="E" onclick="document.getElementById('mapE').style.border='thick solid red'">
      </map>
      
      <!-- div covering all answers -->
    <div class="hide-cursor div-psvt-answers"
      style="top: 465px; height:110px; background-color: rgba(0,0,255,0)">
      <div id="mapA" class="paper-intro-choices" style="left:   5px"></div>
      <div id="mapB" class="paper-intro-choices" style="left: 160px"></div>
      <div id="mapC" class="paper-intro-choices" style="left: 315px"></div>
      <div id="mapD" class="paper-intro-choices" style="left: 470px; color: green;"></div>
      <div id="mapE" class="paper-intro-choices" style="left: 625px"></div>
    </div> 
    <br>
    <!-- end paper intro -->
    <button id="button-end-paper-intro" style="visibility:hidden ;" 
      onclick='nextStage()'>
      Próximo
    </button>
  </section>

  <!-- paper-to-screen task -->
  <section id="tab_paper_task" class="ContentStage" style="display:none"> 
    <div style="position: relative; display: inline-block;">
      <!-- common height of notebooks is 768px.
        Image is 1625x1250, and was resized to 60% of its size in page -->
      <img id="imgmap" src="images/PSVT-R (1).jpg" usemap="#task_alternatives_map" height="750"> 
      <map name="task_alternatives_map" style="cursor: pointer">
        <area shape="rect" coords=" 119,480, 247,660" alt="A" onclick="imgAlternativeChosen('A')">
        <area shape="rect" coords=" 273,480, 401,660" alt="B" onclick="imgAlternativeChosen('B')">
        <area shape="rect" coords=" 430,480, 558,660" alt="C" onclick="imgAlternativeChosen('C')">
        <area shape="rect" coords=" 585,480, 713,660" alt="D" onclick="imgAlternativeChosen('D')">
        <area shape="rect" coords=" 737,480, 865,660" alt="E" onclick="imgAlternativeChosen('E')">
      </map>
      
      <div class="hide-cursor div-psvt-answers" 
      style="background-color: rgba(0,0,255,0) ">
      </div>
    </div> 
    <br>
    <!-- end paper task -->
    <button id="button-end-psvtr" style="visibility:hidden" 
      onclick='nextStage(); unremoveById("jspsych-content");'>
      Next
    </button>
  </section>

  <!-- corsi block tapping task from jsPsych -->
  <section id="corsi-task-container" class="ContentStage" style="display:none"> 
    <p>Corsi block-tapping task</p>

    <div id='corsi-result' style="display:none">
      <p>Blocos de Corsi concluído. Aperte 'Próximo' para prosseguir
      </p>
      <button id="endOfCorsiButton"  onclick='nextStage();
      document.getElementById("iRT-instructions").innerHTML = instructionTextiRT;'>
        Próximo
      </button>
    </div> 
  </section>

  <!-- interactive Rotation Tasks (iRT) -->
  <section id="tab_iRT" class="ContentStage" style="display:none">  <!-- JSmol interactive tasks -->
    <div class="debug" id="indicador_orientacao" style="background-color:gray">Test</div> <!-- orientation coordinates -->

    <table id="table-iRT-canvas"> 
      <tr>
        <button id="startButton" onclick="buttonStart();removeById('iRT-instructions')">Começar!</button>
        <button id="submitButton" onclick="buttonSubmit()" style="visibility:hidden" form="gsForm">Pronto!</button>
      </tr>
      <tr>
        <td class="jsmol-canvas" id="cellLeft">
          <script>
            Jmol.getApplet("jsmolReferenceObject", Info_reference);
          </script>
        </td>
        <td id="tdCenter">
          <span id="iRT-instructions"></span>
          <br>
          <div class="debug">Duration: <output id="timer_onscreen" ></output> s</div>
          <br>
          <button class="debug" onclick="getWindowSize()">scrSize</button>
          <button class="debug" onclick="buttonSubmit()">!POST</button>
          <button class="debug" onclick="timerStop()">timerStop</button>
          <button class="debug" onclick="saveFile()">Save Data Localy</button>
          <button class="debug" onclick="pixelAngstromRatio(randXYZ(jsmolInteractiveObject),jsmolInteractiveObject,1)">px:Angst</button>
          <button class="debug" onclick="Jmol.script(jsmolReferenceObject,'console')">consoleTgt</button>
          <button class="debug" onclick="Jmol.script(jsmolInteractiveObject,'console')">consoleInt</button>
          <br><br>
          <button class="debug" onclick="buildLin(jsmolInteractiveObject)">linear</button>
          <button class="debug" onclick="buildLinMirror(jsmolInteractiveObject)">linear m</button>
          <button class="debug" onclick="buildSeg(jsmolInteractiveObject)">segment</button>
          <button class="debug" onclick="buildSegMirror(jsmolInteractiveObject)">segment m</button>
          <button class="debug" onclick="buildPer(jsmolInteractiveObject)">perimeter</button>
          <button class="debug" onclick="buildPerMirror(jsmolInteractiveObject)">perimeter m</button>
          <button class="debug" onclick="buildFac(jsmolInteractiveObject)">faces</button>
          <button class="debug" onclick="buildFacMirror(jsmolInteractiveObject)">faces m</button>
          <br><br>
          <button class="debug" onclick="Jmol.script(jsmolInteractiveObject, 'select *; color gray;' )">gray</button>
          <button class="debug" onclick="Jmol.script(jsmolInteractiveObject, 'select *; color cpk;' )">cpk</button>
          <button class="debug" onclick="Jmol.script(jsmolInteractiveObject, 'moveTo 0 QUATERNION {0.6249 -0.0366 -0.6990 -0.3458}')">startPosStd</button>
          <button class="debug" onclick="Jmol.script(jsmolInteractiveObject, 'moveTo 0 quaternion {0.7910  0.3605  0.4065  0.2812}')">startPosNew</button>
          
          <div>
            <button id="endTasksButton" onclick="nextStage();closeFullscreen()" style="visibility:hidden">Next</button>
          </div>
    
        </td>
        <td class="jsmol-canvas" id="cellRight"> 
          <script>
            Jmol.getApplet("jsmolInteractiveObject", Info_interactive);
          </script>
        </td>
      </tr>
    </table>
    <div id=jsmol_molecula_console class="debug">Console (wip)</div>
    
  </section>
  
  <!-- End of trials -->
  <section id="tab_fim" class="ContentStage" style="display:none"> <!-- Final words -->
    "Muito obrigado por participar da nossa pesquisa!"<br>
    "Thank you for taking part in our research!"<br>
    <br>
    rodrigo.consoli@alumni.usp.br

    <br><br><br><br>
  </section>

  <button class="debug" id="next_stage_button_debug" onclick="nextStage()">Next stage</button>
  <br>
  <div id="last-updated" class="unhider fixed-footer" style=" font-size:x-small; " >
    <script>
      document.write(`Last updated: `+ document.lastModified);
    </script>
    <span class="hidden-elem" >
      | Download backup copy of data?
      <input id="checkbox-local-backup" type="checkbox" onchange="localSaveSwitch(this)"> 
    </span>
  </div>
  <script src="javascript/scripts.js"></script> <!--needs to load last, uses some elements from the page itself-->
</body>
</html>
